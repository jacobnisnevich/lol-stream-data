<html>
<title>LoL Stream Data</title>
<head>
	<link rel="stylesheet" type="text/css" href="styles.css">
	<link rel="shortcut icon" href="logo_test-ico.ico">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,600' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.4/handlebars.min.js"></script>
</head>
<script id="streamInstance" type="text/x-handlebars-template">
	<div class="featuredInstance">
		<div class="fText" style="padding:0px;">
			<img class="fChamp" src="{{ champImg }}" style="{{ champImgStyle }}">
			<span class="fTitle" style="float:left">
				<a href="player.asp?stream={{ stream }}">
					<b>{{ stream }}</b>
				</a>
			</span>
			<span class="fRole" style="float:right;padding: 10px 10px 0px 0px;">{{ role }}</span>
		</div>
		<div class="fImg"></a><a href="player.asp?stream={{ stream }}"><img src="{{ streamImg }}"></a></div>
	</div>
</script>
<script>
	$(document).ready(function() {
		var templateScript = $("#streamInstance").html();
		var template = Handlebars.compile (templateScript);

		var num = 12;

		// num = <%=Request.Querystring("n")%>

        $.ajax({
            url: 'https://api.twitch.tv/kraken/streams?game=League+of+Legends',
            dataType: 'jsonp',
            success: function(dataWeGotViaJsonp) {
                var text = '';
                var len = dataWeGotViaJsonp.streams.length;
                for (var i = 0; i < num; i++) {
                	(function (i) {
	                    $.ajax({
				            url: 'GetStreamData.asp?stream=' + dataWeGotViaJsonp.streams[i].channel.name,
				            dataType: 'json',
				            success: function(streamData) {			           
				            	topStream = dataWeGotViaJsonp.streams[i];
				            	if (streamData.champion != "") {
					            	data = {
			                    		champImg: 'images/champions/' + streamData.champion + 'Square.png',
			                    		champImgStyle: 'width:24px; height:24px; float: left; padding: 13px 5px 5px 0px;',
			                    		stream: topStream.channel.name,
			                    		role: streamData.role,
			                    		streamImg: topStream.preview.medium
			                    	};
			                    } else {
			                    	data = {
			                    		champImg: '',
			                    		champImgStyle: '',
			                    		stream: topStream.channel.name,
			                    		role: streamData.role,
			                    		streamImg: topStream.preview.medium
			                    	};
			                    }
		                    	$("#featuredStreamsContainer").append(template(data));
		                    }
				        });
					}) (i);
                }
            }
        });

		$("#checkTop").change(function() {
			$("span[class^='fRole']").each(function() {
				if ($(this).text() == "TOP") {
					$(this).parent().closest('div').parent().closest('div').toggle("slide");
				}
			});
		});
		$("#checkJungler").change(function() {
			$("span[class^='fRole']").each(function() {
				if ($(this).text() == "JUNGLER") {
					$(this).parent().closest('div').parent().closest('div').toggle("slide");
				}
			});
		});
		$("#checkMid").change(function() {
			$("span[class^='fRole']").each(function() {
				if ($(this).text() == "MID") {
					$(this).parent().closest('div').parent().closest('div').toggle("slide");
				}
			});
		});
		$("#checkADC").change(function() {
			$("span[class^='fRole']").each(function() {
				if ($(this).text() == "ADC") {
					$(this).parent().closest('div').parent().closest('div').toggle("slide");
				}
			});
		});
		$("#checkSupport").change(function() {
			$("span[class^='fRole']").each(function() {
				if ($(this).text() == "SUPPORT") {
					$(this).parent().closest('div').parent().closest('div').toggle("slide");
				}
			});
		});
    })
</script>
<body>
	<div id="topBar" align="center" valign="center">
		<span id="logo"><a href="/lol-stream-data">LOL STREAM DATA</a></span>
		<span><a href="/lol-stream-data">All Streams</a></span>
		<span>Categories</span>
		<span><a href="contribute.asp">Contribute</a></span>
		<span>About</span>
	</div>
	<div id="streamFilter">
		<form>
			<div>Top: <input type="checkbox" id="checkTop" checked></div>
			<div>Jungler: <input type="checkbox" id="checkJungler" checked></div>
			<div>Mid: <input type="checkbox" id="checkMid" checked></div>
			<div>ADC: <input type="checkbox" id="checkADC" checked></div>
			<div>Support: <input type="checkbox" id="checkSupport" checked></div>
		</form>
 	</div>
	<div id="content">
		<div id="featured">
			<div class="contentTitle">Top Streams</div>
			<div id="featuredStreamsContainer">
				
			</div>
		</div>
	</div>
</body>
</html>